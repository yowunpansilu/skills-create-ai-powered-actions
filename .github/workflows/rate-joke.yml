name: Rate Joke
run-name: Rate Joke by ${{ github.event.comment.user.login }}

on:
  issue_comment:
    types: [created]

permissions:
  issues: write
  contents: read
  models: read


jobs:
  joke:
    name: Rate Joke
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v6
      - name: Rate Joke
        id: rate-joke
        uses: ./
        with:
          joke: ${{ github.event.comment.body }}
          token: ${{ secrets.GITHUB_TOKEN }}
      - name: Update comment
        if: fromJSON(steps.rate-joke.outputs.result).is_joke == true
        uses: peter-evans/create-or-update-comment@v5
        with:
          comment-id: ${{ github.event.comment.id }}
          reactions: laugh
          edit-mode: replace
          body: |
            ## ðŸ¤– AI Joke Rating Results

            **Your joke:**
            > ${{ github.event.comment.body }}

            **AI Analysis:**
            - **Score:** ${{ fromJSON(steps.rate-joke.outputs.result).score }}/10
            - **Humor Type:** ${{ fromJSON(steps.rate-joke.outputs.result).humor_type }}
            - **Feedback:** ${{ fromJSON(steps.rate-joke.outputs.result).feedback }}